{
    # Global options
    auto_https off
    log {
        output stdout
        format console
    }
}

# Main site with all routes
:80 {
    # Health check endpoint
    handle /health {
        respond "healthy" 200
    }
    
    # Ping service routes
    handle /ping* {
        reverse_proxy ping:8080 {
            health_uri /actuator/health
            health_interval 30s
            health_timeout 5s
            header_up Host {host}
            header_up X-Real-IP {remote}
            header_up X-Forwarded-For {remote}
            header_up X-Forwarded-Proto {scheme}
            header_up Connection {>Connection}
            header_up Upgrade {>Upgrade}
        }
    }
    
    # Pong service routes  
    handle /pong* {
        reverse_proxy pong:8080 {
            health_uri /actuator/health
            health_interval 30s
            health_timeout 5s
            header_up Host {host}
            header_up X-Real-IP {remote}
            header_up X-Forwarded-For {remote}
            header_up X-Forwarded-Proto {scheme}
            header_up Connection {>Connection}
            header_up Upgrade {>Upgrade}
        }
    }
    
    # Default route - redirect to ping service
    handle {
        reverse_proxy ping:8080 {
            health_uri /actuator/health
            health_interval 30s
            health_timeout 5s
        }
    }
}
